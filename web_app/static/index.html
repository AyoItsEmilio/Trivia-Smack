<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
<script src="http://ajax.aspnetcdn.com/ajax/jquery/jquery-1.9.0.js"></script>
<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/knockout/knockout-2.2.1.js"></script>
</head>
<link rel=stylesheet type=text/css href="style.css">
<body>
    <div id="main" class="container" data-bind="if: gameStarted">
        <!-- ko foreach: questions -->
            <p data-bind="text: question"></p>
            <!-- ko foreach: options -->
                <p data-bind="text: option, click: $parents[1].beginEdit" class="button option"></p><br><br>
            <!-- /ko -->
        <!-- /ko -->
    </div>

    <script type="text/javascript">

    function TasksViewModel() {
        var self = this;
        self.questionsURI = "http://127.0.0.1:5000/api/question_data/3";
        self.questions = ko.observableArray();
        self.gameStarted = ko.observable(false);

        self.ajax = function(uri, method, data) {
            var request = {
                url: uri,
                type: method,
                contentType: "application/json",
                accepts: "application/json",
                cache: false,
                dataType: 'json',
                data: JSON.stringify(data),
                error: function(jqXHR) {
                    console.log("ajax error " + jqXHR.status);
                }
            };
            return $.ajax(request);
        }

        self.beginEdit = function(option) {
            alert(option.id);
        }

        self.ajax(self.questionsURI, 'GET').done(function(data) {
            for (var i = 0; i < data.questions.length; i++) {

                var obs_options = ko.observableArray();

                for (var j = 0; j < data.questions[i].options.length; j++){
                    obs_options.push({
                        option: ko.observable(data.questions[i].options[j]),
                        id: j
                    });
                }

                self.questions.push({
                    question: ko.observable(data.questions[i].question),
                    options: obs_options,
                    answer: data.questions[i].answer
                });
            }
        });
    }
    ko.applyBindings(new TasksViewModel(), $('#main')[0]);

    </script>
</body>
</html>